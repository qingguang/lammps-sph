echo               both
dimension          3
units              si
atom_style         meso
boundary          p p p
include      pi-3d-vars.lmp
# create simulation box
#3D box
region             box block 0.0 ${Lx}  0.0 ${Ly} 0.0 ${Lz} units box
create_box         1 box

# create fluid particles
lattice            sc ${dx}
create_atoms       1 region box

mass               1 ${sdpd_mass}
set                group all meso_rho ${sdpd_rho}



# use Tait's EOS in combination with Morris' laminar viscosity.
# We set rho_0 = 1000 kg/m^3, c = 0.1 m/s, h = 6.5e-5 m.
# The dynamic viscosity is set to 1.0e-3 Pa s, corresponding to a kinematic viscosity of 1.0e-6 m^2/s
pair_style         hybrid/overlay sph/rhosum 1 sdpd
#variable           sdpd_temp index 1e9
pair_coeff         * * sph/rhosum   ${h}
pair_coeff         * *    sdpd ${sdpd_rho} ${sdpd_c} ${sdpd_eta} ${h}  ${sdpd_temp}

compute            sdpd_kin all temp
compute            rho_peratom all meso_rho/atom

# do full time integration for shear driver and fluid, but keep walls stationary
fix                integrate_fix_full all meso

#variable            A_kol equal 1000
variable            var_kol atom ${A_kol}*${sdpd_mass}*cos(2*PI*y/${Ly})
fix                 kol_force all addforce v_var_kol 0.0 0.0

# average velocity
variable          Nfreq equal 1000
compute vxav all reduce ave vx
variable  vx_cm atom vx-c_vxav
fix av_vx all ave/spatial 1 ${Nfreq} ${Nfreq} &
y center 0.01 v_vx_cm file vx.av ave running units reduced

dump               dump_id all custom 1000 dump*.dat id type x y z vx vy vy c_rho_peratom
dump_modify        dump_id first yes
dump_modify        dump_id sort id
dump_modify        dump_id pad 8
thermo_style       custom step c_sdpd_kin
thermo_modify      norm no
thermo             1

dump imgDump all image 1000 image.*.jpg type type  adiam 2.5e-1 view 0 0 zoom 1.3  box yes 0.01
dump_modify        imgDump pad 9
dump imgDump2 all image 1000 image2.*.jpg type type adiam 2.5e-1 view 60 60 zoom 1.3  box yes 0.01
dump_modify        imgDump2 pad 9
include            settimestep.lmp

neighbor           3.0e-6 bin
timestep           ${dt}
communicate        single vel yes

run                100000
